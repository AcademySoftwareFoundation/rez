language: python

matrix:
  include:
    - python: 2.7
      os: linux
      before_install:
        - sudo apt-get install tcsh -y
        - sudo apt-get install csh -y
    # Travis CI does not support Python on Mac OS out of the box, this is a
    # simple workaround until they can. More info:
    # https://github.com/travis-ci/travis-ci/issues/2312
    - language: generic
      os: osx
      before_install:
        - brew update
        - brew install tcsh
        # The Python version might already be installed and has some symlinks
        # lying around. We remove the symlinks only when the version is not yet
        # installed of course.
        - if ! [ brew list python@2 ] && [ -L /usr/local/bin/python2 ]; then
          brew unlink python;
          fi
        # brew install errors out if the formulae is already installed, lets
        # check and make sure we actually need to install Python.
        - if ! [ brew list python@2 ]; then brew install python@2; fi
        - export PATH="/usr/local/opt/python@2/libexec/bin:$PATH"
        - virtualenv env -p python2
        - source env/bin/activate
install:
  - 'python ./install.py ../rez_install'

script:
  - '"../rez_install/bin/rez/rez-selftest"'
